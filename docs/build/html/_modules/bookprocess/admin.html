

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bookprocess.admin &mdash; Book Library 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Book Library
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bookprocess.html">bookprocess package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.admin.html">admin</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminSave"><code class="docutils literal notranslate"><span class="pre">AdminSave</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminSave.save_model"><code class="docutils literal notranslate"><span class="pre">AdminSave.save_model()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminDelete"><code class="docutils literal notranslate"><span class="pre">AdminDelete</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminDelete.delete_model"><code class="docutils literal notranslate"><span class="pre">AdminDelete.delete_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminDelete.delete_queryset"><code class="docutils literal notranslate"><span class="pre">AdminDelete.delete_queryset()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination"><code class="docutils literal notranslate"><span class="pre">AdminPagination</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.multiple_url"><code class="docutils literal notranslate"><span class="pre">AdminPagination.multiple_url</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.multiple_button"><code class="docutils literal notranslate"><span class="pre">AdminPagination.multiple_button</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.change_list_template"><code class="docutils literal notranslate"><span class="pre">AdminPagination.change_list_template</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.list_per_page"><code class="docutils literal notranslate"><span class="pre">AdminPagination.list_per_page</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.list_per_page_options"><code class="docutils literal notranslate"><span class="pre">AdminPagination.list_per_page_options</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.__init__"><code class="docutils literal notranslate"><span class="pre">AdminPagination.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.populate_url"><code class="docutils literal notranslate"><span class="pre">AdminPagination.populate_url</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.populate_button"><code class="docutils literal notranslate"><span class="pre">AdminPagination.populate_button</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.changelist_view"><code class="docutils literal notranslate"><span class="pre">AdminPagination.changelist_view()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.Media"><code class="docutils literal notranslate"><span class="pre">AdminPagination.Media</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.Media.js"><code class="docutils literal notranslate"><span class="pre">AdminPagination.Media.js</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate"><code class="docutils literal notranslate"><span class="pre">AdminPopulate</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.populate_form_class"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.populate_form_class</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.populate_command_class"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.populate_command_class</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.is_zip_file"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.is_zip_file</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.admin_file_upload_form"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.admin_file_upload_form</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.__init__"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.populate_route"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.populate_route</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.populate_title"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.populate_title</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.get_urls"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.get_urls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.populate_view"><code class="docutils literal notranslate"><span class="pre">AdminPopulate.populate_view()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._execute_command"><code class="docutils literal notranslate"><span class="pre">AdminPopulate._execute_command()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._handle_file_upload"><code class="docutils literal notranslate"><span class="pre">AdminPopulate._handle_file_upload()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._handle_command_execution"><code class="docutils literal notranslate"><span class="pre">AdminPopulate._handle_command_execution()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._extract_excel_from_zip"><code class="docutils literal notranslate"><span class="pre">AdminPopulate._extract_excel_from_zip()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminCount"><code class="docutils literal notranslate"><span class="pre">AdminCount</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminCount.aggregate_count"><code class="docutils literal notranslate"><span class="pre">AdminCount.aggregate_count()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV"><code class="docutils literal notranslate"><span class="pre">AdminWriteCSV</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV.sections"><code class="docutils literal notranslate"><span class="pre">AdminWriteCSV.sections</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV.__init__"><code class="docutils literal notranslate"><span class="pre">AdminWriteCSV.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV.filename"><code class="docutils literal notranslate"><span class="pre">AdminWriteCSV.filename</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV.export_csv"><code class="docutils literal notranslate"><span class="pre">AdminWriteCSV.export_csv()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON"><code class="docutils literal notranslate"><span class="pre">AdminWriteJSON</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON.actions"><code class="docutils literal notranslate"><span class="pre">AdminWriteJSON.actions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON.__init__"><code class="docutils literal notranslate"><span class="pre">AdminWriteJSON.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON.filename"><code class="docutils literal notranslate"><span class="pre">AdminWriteJSON.filename</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON.export_as_json"><code class="docutils literal notranslate"><span class="pre">AdminWriteJSON.export_as_json()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm"><code class="docutils literal notranslate"><span class="pre">AdminPopulateForm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.allowed_extensions"><code class="docutils literal notranslate"><span class="pre">AdminPopulateForm.allowed_extensions</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.__init__"><code class="docutils literal notranslate"><span class="pre">AdminPopulateForm.__init__()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.file_label"><code class="docutils literal notranslate"><span class="pre">AdminPopulateForm.file_label</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.file_help_text"><code class="docutils literal notranslate"><span class="pre">AdminPopulateForm.file_help_text</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.clean"><code class="docutils literal notranslate"><span class="pre">AdminPopulateForm.clean()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.NationalityAdmin"><code class="docutils literal notranslate"><span class="pre">NationalityAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.NationalityAdmin.list_display"><code class="docutils literal notranslate"><span class="pre">NationalityAdmin.list_display</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.NationalityAdmin.search_fields"><code class="docutils literal notranslate"><span class="pre">NationalityAdmin.search_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.NationalityAdmin.populate_command_class"><code class="docutils literal notranslate"><span class="pre">NationalityAdmin.populate_command_class</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.GenreAdmin"><code class="docutils literal notranslate"><span class="pre">GenreAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.GenreAdmin.list_display"><code class="docutils literal notranslate"><span class="pre">GenreAdmin.list_display</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.GenreAdmin.search_fields"><code class="docutils literal notranslate"><span class="pre">GenreAdmin.search_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.GenreAdmin.populate_command_class"><code class="docutils literal notranslate"><span class="pre">GenreAdmin.populate_command_class</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.list_display"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin.list_display</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.list_filter"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin.list_filter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.search_fields"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin.search_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.exclude"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin.exclude</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.changes_formatted"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin.changes_formatted()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.formatted_timestamp"><code class="docutils literal notranslate"><span class="pre">LogEntryAdmin.formatted_timestamp()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin"><code class="docutils literal notranslate"><span class="pre">StatisticAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.change_list_template"><code class="docutils literal notranslate"><span class="pre">StatisticAdmin.change_list_template</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.get_books_per_genre"><code class="docutils literal notranslate"><span class="pre">StatisticAdmin.get_books_per_genre()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.get_authors_per_nationality"><code class="docutils literal notranslate"><span class="pre">StatisticAdmin.get_authors_per_nationality()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.get_author_stats"><code class="docutils literal notranslate"><span class="pre">StatisticAdmin.get_author_stats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.changelist_view"><code class="docutils literal notranslate"><span class="pre">StatisticAdmin.changelist_view()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.model"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.can_delete"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.can_delete</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.extra"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.extra</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.max_num"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.max_num</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.show_change_link"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.show_change_link</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.fields"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.readonly_fields"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.readonly_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.title"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.title()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.authors"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.authors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.genre"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.genre()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.isbn"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.isbn()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.cover"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.cover()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.adapted"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.adapted()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.film_title"><code class="docutils literal notranslate"><span class="pre">AuthorBookInLine.film_title()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorPopulateForm"><code class="docutils literal notranslate"><span class="pre">AuthorPopulateForm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorPopulateForm.allowed_extensions"><code class="docutils literal notranslate"><span class="pre">AuthorPopulateForm.allowed_extensions</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.inlines"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.inlines</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.list_display"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.list_display</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.search_fields"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.search_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.list_filter"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.list_filter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.populate_form_class"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.populate_form_class</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.populate_command_class"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.populate_command_class</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.get_readonly_fields"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.get_readonly_fields()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.name"><code class="docutils literal notranslate"><span class="pre">AuthorAdmin.name()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm"><code class="docutils literal notranslate"><span class="pre">BookForm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Meta"><code class="docutils literal notranslate"><span class="pre">BookForm.Meta</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Meta.model"><code class="docutils literal notranslate"><span class="pre">BookForm.Meta.model</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Meta.fields"><code class="docutils literal notranslate"><span class="pre">BookForm.Meta.fields</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.clean"><code class="docutils literal notranslate"><span class="pre">BookForm.clean()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Media"><code class="docutils literal notranslate"><span class="pre">BookForm.Media</span></code></a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Media.js"><code class="docutils literal notranslate"><span class="pre">BookForm.Media.js</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookForm._meta"><code class="docutils literal notranslate"><span class="pre">BookForm._meta</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAddMultipleForm"><code class="docutils literal notranslate"><span class="pre">BookAddMultipleForm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAddMultipleForm.author"><code class="docutils literal notranslate"><span class="pre">BookAddMultipleForm.author</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.model"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline.model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.extra"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline.extra</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.fields"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline.fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.autocomplete_fields"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline.autocomplete_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.sortable_field_name"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline.sortable_field_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.get_extra"><code class="docutils literal notranslate"><span class="pre">BookAuthorInline.get_extra()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookPopulateForm"><code class="docutils literal notranslate"><span class="pre">BookPopulateForm</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookPopulateForm.allowed_extensions"><code class="docutils literal notranslate"><span class="pre">BookPopulateForm.allowed_extensions</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin"><code class="docutils literal notranslate"><span class="pre">BookAdmin</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.form"><code class="docutils literal notranslate"><span class="pre">BookAdmin.form</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.inlines"><code class="docutils literal notranslate"><span class="pre">BookAdmin.inlines</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.list_display"><code class="docutils literal notranslate"><span class="pre">BookAdmin.list_display</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.search_fields"><code class="docutils literal notranslate"><span class="pre">BookAdmin.search_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.list_filter"><code class="docutils literal notranslate"><span class="pre">BookAdmin.list_filter</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.readonly_fields"><code class="docutils literal notranslate"><span class="pre">BookAdmin.readonly_fields</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.fieldsets"><code class="docutils literal notranslate"><span class="pre">BookAdmin.fieldsets</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.multiple_url"><code class="docutils literal notranslate"><span class="pre">BookAdmin.multiple_url</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.multiple_button"><code class="docutils literal notranslate"><span class="pre">BookAdmin.multiple_button</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.populate_form_class"><code class="docutils literal notranslate"><span class="pre">BookAdmin.populate_form_class</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.populate_command_class"><code class="docutils literal notranslate"><span class="pre">BookAdmin.populate_command_class</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.is_zip_file"><code class="docutils literal notranslate"><span class="pre">BookAdmin.is_zip_file</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.display_authors"><code class="docutils literal notranslate"><span class="pre">BookAdmin.display_authors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.cover_preview"><code class="docutils literal notranslate"><span class="pre">BookAdmin.cover_preview()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.save_model"><code class="docutils literal notranslate"><span class="pre">BookAdmin.save_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.save_formset"><code class="docutils literal notranslate"><span class="pre">BookAdmin.save_formset()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._save_authors_from_formset"><code class="docutils literal notranslate"><span class="pre">BookAdmin._save_authors_from_formset()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._finalize_book_creation"><code class="docutils literal notranslate"><span class="pre">BookAdmin._finalize_book_creation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._update_book_isbn_if_needed"><code class="docutils literal notranslate"><span class="pre">BookAdmin._update_book_isbn_if_needed()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._snapshot_book_state"><code class="docutils literal notranslate"><span class="pre">BookAdmin._snapshot_book_state()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._diff_snapshots"><code class="docutils literal notranslate"><span class="pre">BookAdmin._diff_snapshots()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.get_urls"><code class="docutils literal notranslate"><span class="pre">BookAdmin.get_urls()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.add_multiple_books_view"><code class="docutils literal notranslate"><span class="pre">BookAdmin.add_multiple_books_view()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._handle_multiple_books_post"><code class="docutils literal notranslate"><span class="pre">BookAdmin._handle_multiple_books_post()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._create_books_from_post_data"><code class="docutils literal notranslate"><span class="pre">BookAdmin._create_books_from_post_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._create_single_book_from_post"><code class="docutils literal notranslate"><span class="pre">BookAdmin._create_single_book_from_post()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._extract_book_data_from_post"><code class="docutils literal notranslate"><span class="pre">BookAdmin._extract_book_data_from_post()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._show_creation_message"><code class="docutils literal notranslate"><span class="pre">BookAdmin._show_creation_message()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._render_multiple_books_form"><code class="docutils literal notranslate"><span class="pre">BookAdmin._render_multiple_books_form()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.apps.html">apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.apps.html#bookprocess.apps.BookprocessConfig"><code class="docutils literal notranslate"><span class="pre">BookprocessConfig</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.apps.html#bookprocess.apps.BookprocessConfig.default_auto_field"><code class="docutils literal notranslate"><span class="pre">BookprocessConfig.default_auto_field</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.apps.html#bookprocess.apps.BookprocessConfig.name"><code class="docutils literal notranslate"><span class="pre">BookprocessConfig.name</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.models.html">models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality"><code class="docutils literal notranslate"><span class="pre">Nationality</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.name"><code class="docutils literal notranslate"><span class="pre">Nationality.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.code"><code class="docutils literal notranslate"><span class="pre">Nationality.code</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.DoesNotExist"><code class="docutils literal notranslate"><span class="pre">Nationality.DoesNotExist</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.MultipleObjectsReturned"><code class="docutils literal notranslate"><span class="pre">Nationality.MultipleObjectsReturned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.author_set"><code class="docutils literal notranslate"><span class="pre">Nationality.author_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.id"><code class="docutils literal notranslate"><span class="pre">Nationality.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Nationality.objects"><code class="docutils literal notranslate"><span class="pre">Nationality.objects</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre"><code class="docutils literal notranslate"><span class="pre">Genre</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre.name"><code class="docutils literal notranslate"><span class="pre">Genre.name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre.DoesNotExist"><code class="docutils literal notranslate"><span class="pre">Genre.DoesNotExist</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre.MultipleObjectsReturned"><code class="docutils literal notranslate"><span class="pre">Genre.MultipleObjectsReturned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre.book_set"><code class="docutils literal notranslate"><span class="pre">Genre.book_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre.id"><code class="docutils literal notranslate"><span class="pre">Genre.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Genre.objects"><code class="docutils literal notranslate"><span class="pre">Genre.objects</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author"><code class="docutils literal notranslate"><span class="pre">Author</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.first_name"><code class="docutils literal notranslate"><span class="pre">Author.first_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.last_name"><code class="docutils literal notranslate"><span class="pre">Author.last_name</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.nationality"><code class="docutils literal notranslate"><span class="pre">Author.nationality</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.name"><code class="docutils literal notranslate"><span class="pre">Author.name()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.DoesNotExist"><code class="docutils literal notranslate"><span class="pre">Author.DoesNotExist</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.MultipleObjectsReturned"><code class="docutils literal notranslate"><span class="pre">Author.MultipleObjectsReturned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.bookauthor_set"><code class="docutils literal notranslate"><span class="pre">Author.bookauthor_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.books"><code class="docutils literal notranslate"><span class="pre">Author.books</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.id"><code class="docutils literal notranslate"><span class="pre">Author.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.nationality_id"><code class="docutils literal notranslate"><span class="pre">Author.nationality_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Author.objects"><code class="docutils literal notranslate"><span class="pre">Author.objects</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book"><code class="docutils literal notranslate"><span class="pre">Book</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.title"><code class="docutils literal notranslate"><span class="pre">Book.title</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.authors"><code class="docutils literal notranslate"><span class="pre">Book.authors</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.genre"><code class="docutils literal notranslate"><span class="pre">Book.genre</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.cover"><code class="docutils literal notranslate"><span class="pre">Book.cover</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.adapted"><code class="docutils literal notranslate"><span class="pre">Book.adapted</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.film_title"><code class="docutils literal notranslate"><span class="pre">Book.film_title</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.isbn"><code class="docutils literal notranslate"><span class="pre">Book.isbn</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.generate_isbn"><code class="docutils literal notranslate"><span class="pre">Book.generate_isbn()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.ordered_authors"><code class="docutils literal notranslate"><span class="pre">Book.ordered_authors()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.DoesNotExist"><code class="docutils literal notranslate"><span class="pre">Book.DoesNotExist</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.MultipleObjectsReturned"><code class="docutils literal notranslate"><span class="pre">Book.MultipleObjectsReturned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.bookauthor_set"><code class="docutils literal notranslate"><span class="pre">Book.bookauthor_set</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.genre_id"><code class="docutils literal notranslate"><span class="pre">Book.genre_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.id"><code class="docutils literal notranslate"><span class="pre">Book.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Book.objects"><code class="docutils literal notranslate"><span class="pre">Book.objects</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor"><code class="docutils literal notranslate"><span class="pre">BookAuthor</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.book"><code class="docutils literal notranslate"><span class="pre">BookAuthor.book</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.author"><code class="docutils literal notranslate"><span class="pre">BookAuthor.author</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.order"><code class="docutils literal notranslate"><span class="pre">BookAuthor.order</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.save"><code class="docutils literal notranslate"><span class="pre">BookAuthor.save()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.DoesNotExist"><code class="docutils literal notranslate"><span class="pre">BookAuthor.DoesNotExist</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.MultipleObjectsReturned"><code class="docutils literal notranslate"><span class="pre">BookAuthor.MultipleObjectsReturned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.author_id"><code class="docutils literal notranslate"><span class="pre">BookAuthor.author_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.book_id"><code class="docutils literal notranslate"><span class="pre">BookAuthor.book_id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.id"><code class="docutils literal notranslate"><span class="pre">BookAuthor.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.BookAuthor.objects"><code class="docutils literal notranslate"><span class="pre">BookAuthor.objects</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic"><code class="docutils literal notranslate"><span class="pre">Statistic</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.books_per_genre"><code class="docutils literal notranslate"><span class="pre">Statistic.books_per_genre</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.authors_per_nationality"><code class="docutils literal notranslate"><span class="pre">Statistic.authors_per_nationality</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.authors_stats"><code class="docutils literal notranslate"><span class="pre">Statistic.authors_stats</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.DoesNotExist"><code class="docutils literal notranslate"><span class="pre">Statistic.DoesNotExist</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.MultipleObjectsReturned"><code class="docutils literal notranslate"><span class="pre">Statistic.MultipleObjectsReturned</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.id"><code class="docutils literal notranslate"><span class="pre">Statistic.id</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.models.html#bookprocess.models.Statistic.objects"><code class="docutils literal notranslate"><span class="pre">Statistic.objects</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.views.html">views</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.views.html#bookprocess.views.books_list_view"><code class="docutils literal notranslate"><span class="pre">books_list_view()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.views.html#bookprocess.views.book_detail_view"><code class="docutils literal notranslate"><span class="pre">book_detail_view()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.management.html">management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.management.commands.html">commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_author.html">admin_init_author</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_author.html#bookprocess.management.commands.admin_init_author.Command"><code class="docutils literal notranslate"><span class="pre">Command</span></code></a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_author.html#bookprocess.management.commands.admin_init_author.Command.add_arguments"><code class="docutils literal notranslate"><span class="pre">Command.add_arguments()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_author.html#bookprocess.management.commands.admin_init_author.Command.handle"><code class="docutils literal notranslate"><span class="pre">Command.handle()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_book.html">admin_init_book</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_book.html#bookprocess.management.commands.admin_init_book._to_isbn_string"><code class="docutils literal notranslate"><span class="pre">_to_isbn_string()</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_book.html#bookprocess.management.commands.admin_init_book.Command"><code class="docutils literal notranslate"><span class="pre">Command</span></code></a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_book.html#bookprocess.management.commands.admin_init_book.Command.add_arguments"><code class="docutils literal notranslate"><span class="pre">Command.add_arguments()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_book.html#bookprocess.management.commands.admin_init_book.Command.handle"><code class="docutils literal notranslate"><span class="pre">Command.handle()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_genre.html">admin_init_genre</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_genre.html#bookprocess.management.commands.admin_init_genre.GENRES"><code class="docutils literal notranslate"><span class="pre">GENRES</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_genre.html#bookprocess.management.commands.admin_init_genre.Command"><code class="docutils literal notranslate"><span class="pre">Command</span></code></a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_genre.html#bookprocess.management.commands.admin_init_genre.Command.add_arguments"><code class="docutils literal notranslate"><span class="pre">Command.add_arguments()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_genre.html#bookprocess.management.commands.admin_init_genre.Command.handle"><code class="docutils literal notranslate"><span class="pre">Command.handle()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_nationality.html">admin_init_nationality</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_nationality.html#bookprocess.management.commands.admin_init_nationality.COUNTRIES"><code class="docutils literal notranslate"><span class="pre">COUNTRIES</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_nationality.html#bookprocess.management.commands.admin_init_nationality.Command"><code class="docutils literal notranslate"><span class="pre">Command</span></code></a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_nationality.html#bookprocess.management.commands.admin_init_nationality.Command.add_arguments"><code class="docutils literal notranslate"><span class="pre">Command.add_arguments()</span></code></a></li>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.admin_init_nationality.html#bookprocess.management.commands.admin_init_nationality.Command.handle"><code class="docutils literal notranslate"><span class="pre">Command.handle()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.management.commands.init_roles.html">init_roles</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../bookprocess.management.commands.init_roles.html#bookprocess.management.commands.init_roles.Command"><code class="docutils literal notranslate"><span class="pre">Command</span></code></a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../bookprocess.management.commands.init_roles.html#bookprocess.management.commands.init_roles.Command.handle"><code class="docutils literal notranslate"><span class="pre">Command.handle()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.services.html">services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.services.html#bookprocess.services.AuditLogService"><code class="docutils literal notranslate"><span class="pre">AuditLogService</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.services.html#bookprocess.services.AuditLogService.log_book_creation"><code class="docutils literal notranslate"><span class="pre">AuditLogService.log_book_creation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../bookprocess.services.html#bookprocess.services.AuditLogService.log_book_update"><code class="docutils literal notranslate"><span class="pre">AuditLogService.log_book_update()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../bookprocess.utils.html">utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.PREFIXES"><code class="docutils literal notranslate"><span class="pre">PREFIXES</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.isbn13_check_digit"><code class="docutils literal notranslate"><span class="pre">isbn13_check_digit()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils._normalize_nat_code"><code class="docutils literal notranslate"><span class="pre">_normalize_nat_code()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils._is_allowed_nat_code"><code class="docutils literal notranslate"><span class="pre">_is_allowed_nat_code()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils._get_book_model"><code class="docutils literal notranslate"><span class="pre">_get_book_model()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils._get_main_author_code_from_book"><code class="docutils literal notranslate"><span class="pre">_get_main_author_code_from_book()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.generate_unique_isbn_for_nationality"><code class="docutils literal notranslate"><span class="pre">generate_unique_isbn_for_nationality()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.generate_unique_isbn_from_book"><code class="docutils literal notranslate"><span class="pre">generate_unique_isbn_from_book()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.represent_related"><code class="docutils literal notranslate"><span class="pre">represent_related()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.serialize_model_instance"><code class="docutils literal notranslate"><span class="pre">serialize_model_instance()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bookprocess.utils.html#bookprocess.utils.notify"><code class="docutils literal notranslate"><span class="pre">notify()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Book Library</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">bookprocess.admin</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for bookprocess.admin</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Admin customizations for the bookprocess application.</span>

<span class="sd">This module contains Django ``ModelAdmin`` subclasses, admin helper mixins</span>
<span class="sd">and small admin forms used across the project&#39;s admin interface. Its</span>
<span class="sd">purpose is to centralize common admin behaviour (pagination, file-based</span>
<span class="sd">population commands, CSV/JSON export utilities) and to</span>
<span class="sd">provide model-specific admin classes for ``Author``, ``Book``, ``Genre``,</span>
<span class="sd">``Nationality``, ``BookAuthor`` and supporting audit/logging integrations.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">###########################</span>
<span class="c1">#     Stadard Imports     #</span>
<span class="c1">###########################</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">csv</span><span class="w"> </span><span class="kn">import</span> <span class="n">writer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">json</span><span class="w"> </span><span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tempfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">zipfile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZipFile</span>

<span class="c1">###########################</span>
<span class="c1">#    3rd Party Imports    #</span>
<span class="c1">###########################</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">adminsortable2.admin</span><span class="w"> </span><span class="kn">import</span> <span class="n">SortableInlineAdminMixin</span><span class="p">,</span> <span class="n">SortableAdminBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auditlog.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogEntry</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">auditlog.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_actor</span><span class="p">,</span> <span class="n">disable_auditlog</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django_admin_listfilter_dropdown.filters</span><span class="w"> </span><span class="kn">import</span> <span class="n">DropdownFilter</span><span class="p">,</span> <span class="n">RelatedDropdownFilter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django</span><span class="w"> </span><span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span><span class="p">,</span> <span class="n">messages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Count</span><span class="p">,</span> <span class="n">Case</span><span class="p">,</span> <span class="n">When</span><span class="p">,</span> <span class="n">IntegerField</span><span class="p">,</span> <span class="n">Sum</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.urls</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.utils.html</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_html</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">render</span>

<span class="c1">###########################</span>
<span class="c1">#       Local Imports     #</span>
<span class="c1">###########################</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.management.commands.admin_init_author</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span> <span class="k">as</span> <span class="n">AuthorsCmd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.management.commands.admin_init_book</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span> <span class="k">as</span> <span class="n">BookCmd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.management.commands.admin_init_genre</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span> <span class="k">as</span> <span class="n">GenreCmd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.management.commands.admin_init_nationality</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span> <span class="k">as</span> <span class="n">NationalityCmd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Author</span><span class="p">,</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Genre</span><span class="p">,</span> <span class="n">Nationality</span><span class="p">,</span> <span class="n">BookAuthor</span><span class="p">,</span> <span class="n">Statistic</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.services</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuditLogService</span>

<span class="c1">###########################</span>
<span class="c1">#     Helper Classes      #</span>
<span class="c1">###########################</span>
<div class="viewcode-block" id="AdminSave">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminSave">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminSave</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper mixin to centralize save behaviour for admin models.</span>

<span class="sd">    This mixin sets the audit actor when saving from the admin so audit</span>
<span class="sd">    logs correctly attribute the change to the current user.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AdminSave.save_model">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminSave.save_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the model instance with audit actor set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The active HTTP request.</span>
<span class="sd">        obj : django.db.models.Model</span>
<span class="sd">            The model instance being saved.</span>
<span class="sd">        form : django.forms.Form</span>
<span class="sd">            The admin form used to validate the instance.</span>
<span class="sd">        change : bool</span>
<span class="sd">            True if updating an existing object, False for creation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">set_actor</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="AdminDelete">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminDelete">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminDelete</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper mixin that ensures audit actor is set when deleting models.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="AdminDelete.delete_model">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminDelete.delete_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a single object with audit actor set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        obj : django.db.models.Model</span>
<span class="sd">            The model instance to delete.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">set_actor</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete_model</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminDelete.delete_queryset">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminDelete.delete_queryset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a queryset of objects with audit actor set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        queryset : django.db.models.query.QuerySet</span>
<span class="sd">            The queryset of objects to delete.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">set_actor</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete_queryset</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="AdminPagination">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminPagination</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin to add pagination controls and extra changelist context.&quot;&quot;&quot;</span>
    <span class="n">populate_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: URL suffix for the model population view</span>
    <span class="n">populate_button</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#:Label for the populate button shown in the changelist.</span>
    <span class="n">multiple_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: URL for multi-object operations (e.g. add-multiple view).</span>
    <span class="n">multiple_button</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span><span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Label for the multiple action button.</span>
    <span class="n">change_list_template</span> <span class="o">=</span> <span class="s2">&quot;admin/admin_pagination_changelist.html&quot;</span> <span class="c1">#: Template path used to render the custom changelist when this mixin is applied.</span>
    <span class="n">list_per_page</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1">#:Current page size for the changelist (can be overridden via GET).</span>
    <span class="n">list_per_page_options</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span> <span class="c1">#: Allowed page-size options presented to the user.</span>

<div class="viewcode-block" id="AdminPagination.__init__">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the pagination helper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : django.db.models.Model</span>
<span class="sd">            The model class this admin manages.</span>
<span class="sd">        admin_site : django.contrib.admin.AdminSite</span>
<span class="sd">            The admin site instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">)</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span>
        <span class="n">model_verbose</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name_plural</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;populate-</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">/&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_button</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_button</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Populate </span><span class="si">{</span><span class="n">model_verbose</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="AdminPagination.changelist_view">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.changelist_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">changelist_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Customize the changelist view with pagination and extra template context.</span>

<span class="sd">        Reads an optional ``list_per_page`` GET parameter to adjust the</span>
<span class="sd">        page size for the changelist and injects UI labels/URLs used by</span>
<span class="sd">        the custom changelist template.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request object.</span>
<span class="sd">        extra_context : dict</span>
<span class="sd">            Additional context to include in the template.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse</span>
<span class="sd">            The response returned by the parent ``changelist_view``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request</span><span class="o">.</span><span class="n">GET</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">page_param</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;list_per_page&quot;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">list_per_page</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_per_page</span> <span class="o">=</span> <span class="n">page_param</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_per_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_per_page</span>

        <span class="n">extra_context</span> <span class="o">=</span> <span class="n">extra_context</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;list_per_page_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_per_page_options</span>
        <span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;populate_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_url</span>
        <span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;populate_button&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_button</span>
        <span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;multiple_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple_url</span>
        <span class="n">extra_context</span><span class="p">[</span><span class="s2">&quot;multiple_button&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiple_button</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">changelist_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="n">extra_context</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminPagination.Media">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPagination.Media">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Media</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Media assets required by the pagination UI.&quot;&quot;&quot;</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;admin/js/admin_paginator_dropdown.js&quot;</span><span class="p">,)</span> <span class="c1">#: JavaScript files included on the admin pages that use this mixin.</span></div>
</div>


<div class="viewcode-block" id="AdminPopulate">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminPopulate</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin that provides file-upload and command-based population helpers.&quot;&quot;&quot;</span>
    <span class="n">populate_form_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Form class used to accept uploaded files (when provided).</span>
    <span class="n">populate_command_class</span><span class="p">:</span> <span class="nb">type</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Management command class responsible for importing data.</span>
    <span class="n">is_zip_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#: When True uploaded files are treated as ZIP.</span>
    <span class="n">populate_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Human readable title for the upload page.</span>
    <span class="n">populate_route</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: URL route suffix for the populate view.</span>
    <span class="n">admin_file_upload_form</span> <span class="o">=</span> <span class="s2">&quot;admin/admin_file_upload_form.html&quot;</span> <span class="c1">#: Template path used to render the populate file upload form.</span>

<div class="viewcode-block" id="AdminPopulate.__init__">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the populate helper for this admin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : django.db.models.Model</span>
<span class="sd">            The model class this admin is registered for.</span>
<span class="sd">        admin_site : django.contrib.admin.AdminSite</span>
<span class="sd">            The admin site instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">model_name</span>
        <span class="n">model_verbose</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose_name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_route</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_route</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;populate-</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">/&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">populate_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Populate </span><span class="si">{</span><span class="n">model_verbose</span><span class="si">}</span><span class="s2">&quot;</span></div>


<div class="viewcode-block" id="AdminPopulate.get_urls">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.get_urls">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return admin URLs, prepending the populate route.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of URL patterns for the admin, including the populate route.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span>
        <span class="n">custom_urls</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">path</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">populate_route</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">admin_site</span><span class="o">.</span><span class="n">admin_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populate_view</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">opts</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">opts</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_populate&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">custom_urls</span> <span class="o">+</span> <span class="n">urls</span></div>


<div class="viewcode-block" id="AdminPopulate.populate_view">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate.populate_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">populate_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle requests to the populate endpoint.</span>

<span class="sd">        Depending on which configuration attributes are set this will either</span>
<span class="sd">        render/accept a file upload form (``populate_form_class`` present)</span>
<span class="sd">        or invoke a management command directly (``populate_command_class``).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            Incoming HTTP request from the admin UI.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse or django.http.HttpResponseRedirect</span>
<span class="sd">            Rendered form, success redirect, or error redirect.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_form_class</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_command_class</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_file_upload</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populate_form_class</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_command_class</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_command_execution</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="s2">&quot;No populate method configured.&quot;</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">WARNING</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminPopulate._execute_command">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._execute_command">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_execute_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the configured management command for population.</span>

<span class="sd">        The configured command class is instantiated, given access to the</span>
<span class="sd">        request as ``cmd.request`` and then its ``handle`` method is called</span>
<span class="sd">        with the current user and any ``extra_kwargs`` (for example the</span>
<span class="sd">        path to an extracted Excel file).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current HTTP request.</span>
<span class="sd">        **extra_kwargs : dict</span>
<span class="sd">            Extra keyword arguments forwarded to the command&#39;s ``handle``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponseRedirect</span>
<span class="sd">            Redirects back to the model changelist after execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_command_class</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span>
                <span class="n">request</span><span class="p">,</span>
                <span class="s2">&quot;No populate command class defined.&quot;</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">WARNING</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_command_class</span><span class="p">()</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_kwargs</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminPopulate._handle_file_upload">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._handle_file_upload">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_file_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the populate file upload and run the populate command.</span>

<span class="sd">        On POST this validates the form, writes the uploaded file to a</span>
<span class="sd">        temporary directory and, if configured, extracts an Excel file from</span>
<span class="sd">        a ZIP archive before calling ``_execute_command`` with the file path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The incoming request containing POST data and FILES.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse or django.shortcuts.render</span>
<span class="sd">            Redirect after processing or the rendered upload form for GET or</span>
<span class="sd">            invalid data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_form_class</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
                <span class="n">uploaded_file</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">uploaded_file</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;No file uploaded.&quot;</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span>

                <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
                    <span class="n">tmpdir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span>
                    <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">tmpdir</span> <span class="o">/</span> <span class="n">uploaded_file</span><span class="o">.</span><span class="n">name</span>

                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;wb+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">uploaded_file</span><span class="o">.</span><span class="n">chunks</span><span class="p">():</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_zip_file</span><span class="p">:</span>
                        <span class="n">excel_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_excel_from_zip</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">excel_file</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;No Excel file found in ZIP.&quot;</span><span class="p">,</span>
                                              <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">excel_file</span> <span class="o">=</span> <span class="n">tmp_path</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_execute_command</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">excel_file</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">excel_file</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">message_user</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">messages</span><span class="o">.</span><span class="n">ERROR</span><span class="p">)</span>

                    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_form_class</span><span class="p">()</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_site</span><span class="o">.</span><span class="n">each_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">populate_title</span><span class="p">,</span>
            <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="n">opts</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_file_upload_form</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminPopulate._handle_command_execution">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._handle_command_execution">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_command_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the configured populate command without a file upload.</span>

<span class="sd">        This is used when the admin configuration provides only</span>
<span class="sd">        ``populate_command_class`` and expects the command to perform any</span>
<span class="sd">        required actions itself.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The incoming request.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponseRedirect</span>
<span class="sd">            Redirect back to the model changelist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_command</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></div>


<div class="viewcode-block" id="AdminPopulate._extract_excel_from_zip">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulate._extract_excel_from_zip">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_excel_from_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zip_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract the first Excel file (``*.xlsx``) from a ZIP archive.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zip_path : pathlib.Path</span>
<span class="sd">            Path to the ZIP file on disk.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pathlib.Path</span>
<span class="sd">            Path to the extracted Excel file if found, otherwise ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extract_path</span> <span class="o">=</span> <span class="n">zip_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">zip_path</span><span class="o">.</span><span class="n">stem</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span>

            <span class="n">excel_file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">extract_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.xlsx&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">excel_file</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>
</div>


<div class="viewcode-block" id="AdminCount">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminCount">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminCount</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Small mixin providing a grouped count helper used by statistics admins. &quot;&quot;&quot;</span>
<div class="viewcode-block" id="AdminCount.aggregate_count">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminCount.aggregate_count">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">value_field</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return aggregated counts grouped by a related field.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : django.db.models.Model</span>
<span class="sd">            The model to query (for example ``Book``).</span>
<span class="sd">        value_field : str</span>
<span class="sd">            The related field to group by (for example ``&#39;genre__name&#39;``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.db.models.query.QuerySet</span>
<span class="sd">            QuerySet of dicts containing the grouped value and a ``count`` key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">model</span><span class="o">.</span><span class="n">objects</span>
            <span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">value_field</span><span class="p">)</span>
            <span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
            <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;-count&quot;</span><span class="p">)</span>
        <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="AdminWriteCSV">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminWriteCSV</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin to export admin data as CSV files.&quot;&quot;&quot;</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#:  Default filename for the generated CSV when not overridden.</span>
    <span class="n">sections</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#:Sections configuration used by :meth:`export_csv` describing title headers, rows iterable and a row formatting callable.</span>

<div class="viewcode-block" id="AdminWriteCSV.__init__">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the CSV export mixin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : django.db.models.Model</span>
<span class="sd">            The model class that the admin wraps.</span>
<span class="sd">        admin_site : django.contrib.admin.AdminSite</span>
<span class="sd">            The admin site instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">)</span>

        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">model_name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.csv&quot;</span></div>


<div class="viewcode-block" id="AdminWriteCSV.export_csv">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteCSV.export_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sections</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an HttpResponse with the supplied sections written as CSV.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sections : Iterable</span>
<span class="sd">            Iterable of tuples (title, headers, rows, row_func) describing</span>
<span class="sd">            each CSV section. ``row_func`` is called with each row object to</span>
<span class="sd">            return an iterable of values to write.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse</span>
<span class="sd">            Response object containing the CSV payload and appropriate</span>
<span class="sd">            Content-Disposition header for download.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;text/csv; charset=utf-8&#39;</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\ufeff</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">writer_csv</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">write_section</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">row_func</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Write a single CSV section to the response writer.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            title : str</span>
<span class="sd">                Section title written as a heading row.</span>
<span class="sd">            headers : Iterable</span>
<span class="sd">                Iterable of header column names.</span>
<span class="sd">            rows : Iterable</span>
<span class="sd">                Iterable of row objects to be formatted.</span>
<span class="sd">            row_func : Callable</span>
<span class="sd">                Callable that accepts a row object and returns an iterable</span>
<span class="sd">                of column values for that row.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None</span>
<span class="sd">                Writes directly to the CSV writer attached to the response.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">writer_csv</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">title</span><span class="p">])</span>
            <span class="n">writer_csv</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">writer_csv</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row_func</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
            <span class="n">writer_csv</span><span class="o">.</span><span class="n">writerow</span><span class="p">([])</span>

        <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">row_func</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="n">write_section</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">row_func</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span></div>
</div>


<div class="viewcode-block" id="AdminWriteJSON">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminWriteJSON</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mixin to add a JSON export action to admin classes.&quot;&quot;&quot;</span>

    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Default filename for the exported JSON file.</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;export_as_json&#39;</span><span class="p">]</span> <span class="c1">#: Admin actions exposed by this mixin.</span>

<div class="viewcode-block" id="AdminWriteJSON.__init__">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the JSON export mixin.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : django.db.models.Model</span>
<span class="sd">            The model class this admin represents.</span>
<span class="sd">        admin_site : django.contrib.admin.AdminSite</span>
<span class="sd">            The admin site instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">admin_site</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_meta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;exclude&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">opts</span><span class="o">.</span><span class="n">get_fields</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">many_to_many</span> <span class="ow">or</span> <span class="n">f</span><span class="o">.</span><span class="n">one_to_many</span><span class="p">)</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.json&quot;</span></div>


<div class="viewcode-block" id="AdminWriteJSON.export_as_json">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminWriteJSON.export_as_json">[docs]</a>
    <span class="nd">@admin</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Export selected items as JSON&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">export_as_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">queryset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Admin action: export the selected objects as a JSON file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        queryset : django.db.models.query.QuerySet</span>
<span class="sd">            The selected objects to export.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse</span>
<span class="sd">            A response containing the JSON representation and an</span>
<span class="sd">            appropriate Content-Disposition header for download.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">obj_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_fields</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

                <span class="n">obj_data</span><span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_data</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span>
            <span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;Content-Disposition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;attachment; filename=&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">return</span> <span class="n">response</span></div>
</div>


<div class="viewcode-block" id="AdminPopulateForm">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AdminPopulateForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base form used by admin populate views to accept a single file.&quot;&quot;&quot;</span>

    <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#: File extensions accepted by the form (e.g. [&#39;.xlsx&#39;, &#39;.zip&#39;]).</span>
    <span class="n">file_label</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Label for the input; auto-generated when ``None``.</span>
    <span class="n">file_help_text</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#: Help text for the input; auto-generated when ``None``.</span>

<div class="viewcode-block" id="AdminPopulateForm.__init__">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the populate form.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args, **kwargs</span>
<span class="sd">            Forwarded to ``forms.Form.__init__``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">:</span>
                <span class="n">ext_str</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Upload </span><span class="si">{</span><span class="n">ext_str</span><span class="si">}</span><span class="s2"> File&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_label</span> <span class="o">=</span> <span class="s2">&quot;Upload File&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_help_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_help_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Allowed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_help_text</span> <span class="o">=</span> <span class="s2">&quot;Select a file.&quot;</span>

        <span class="n">widget_attrs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">:</span>
            <span class="n">widget_attrs</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">FileField</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_label</span><span class="p">,</span>
            <span class="n">help_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">file_help_text</span><span class="p">,</span>
            <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">ClearableFileInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="n">widget_attrs</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AdminPopulateForm.clean">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AdminPopulateForm.clean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the uploaded file and ensure allowed extension.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The cleaned form data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">:</span>
            <span class="n">file_ext</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">allowed_exts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">file_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_exts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Only </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allowed_extensions</span><span class="p">)</span><span class="si">}</span><span class="s2"> allowed.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cleaned_data</span></div>
</div>


<span class="c1">############################</span>
<span class="c1">#    Nationality Class     #</span>
<span class="c1">############################</span>
<div class="viewcode-block" id="NationalityAdmin">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.NationalityAdmin">[docs]</a>
<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Nationality</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NationalityAdmin</span><span class="p">(</span><span class="n">AdminPagination</span><span class="p">,</span> <span class="n">AdminPopulate</span><span class="p">,</span> <span class="n">AdminSave</span><span class="p">,</span> <span class="n">AdminDelete</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin for the :class:`bookprocess.models.Nationality` lookup model.&quot;&quot;&quot;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span> <span class="c1">#: Fields shown in the changelist (``name``, ``code``).</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">list_display</span> <span class="c1">#: Fields used for search.</span>
    <span class="n">populate_command_class</span> <span class="o">=</span> <span class="n">NationalityCmd</span> <span class="c1">#: Management command used to populate nationality data.</span></div>


<span class="c1">############################</span>
<span class="c1">#       Genre Class        #</span>
<span class="c1">############################</span>
<div class="viewcode-block" id="GenreAdmin">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.GenreAdmin">[docs]</a>
<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Genre</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GenreAdmin</span><span class="p">(</span><span class="n">AdminPagination</span><span class="p">,</span> <span class="n">AdminPopulate</span><span class="p">,</span> <span class="n">AdminSave</span><span class="p">,</span> <span class="n">AdminDelete</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin for the :class:`bookprocess.models.Genre` lookup model.&quot;&quot;&quot;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,)</span> <span class="c1">#: Fields shown in the changelist (``name``).</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="n">list_display</span> <span class="c1">#: Fields used for search.</span>
    <span class="n">populate_command_class</span> <span class="o">=</span> <span class="n">GenreCmd</span> <span class="c1">#: Management command used to populate genre data.</span></div>


<span class="c1">############################</span>
<span class="c1">#      AuditLog Class      #</span>
<span class="c1">############################</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">LogEntry</span><span class="p">)</span>
<div class="viewcode-block" id="LogEntryAdmin">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin">[docs]</a>
<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">LogEntry</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEntryAdmin</span><span class="p">(</span><span class="n">AdminWriteJSON</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin for audit log entries with helper formatters.&quot;&quot;&quot;</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;formatted_timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">,</span> <span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;object_repr&quot;</span><span class="p">,</span> <span class="s2">&quot;changes_formatted&quot;</span><span class="p">)</span> <span class="c1">#: Standard Django admin option for list display and filtering.</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;actor&quot;</span><span class="p">)</span> <span class="c1">#: Standard Django admin option for list display and filtering.</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;object_repr&quot;</span><span class="p">,</span> <span class="s2">&quot;actor__username&quot;</span><span class="p">,</span> <span class="s2">&quot;changes&quot;</span><span class="p">)</span> <span class="c1">#: Standard Django admin option for list display and filtering.</span>
    <span class="n">exclude</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;object_pk&#39;</span><span class="p">,</span>
        <span class="s1">&#39;serialized_data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;changes_text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cid&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remote_addr&#39;</span><span class="p">,</span>
        <span class="s1">&#39;remote_port&#39;</span><span class="p">,</span>
        <span class="s1">&#39;additional_data&#39;</span><span class="p">,</span>
        <span class="s1">&#39;actor_email&#39;</span><span class="p">,</span>
    <span class="p">]</span> <span class="c1">#: Standard Django admin option for list display and filtering.</span>

<div class="viewcode-block" id="LogEntryAdmin.changes_formatted">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.changes_formatted">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">changes_formatted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format the stored change payload resolving related FK names.</span>

<span class="sd">        This helper transforms the JSON-like ``changes`` stored on audit</span>
<span class="sd">        log entries into a readable string. When a changed field is a</span>
<span class="sd">        ForeignKey the helper will attempt to look up the referred object</span>
<span class="sd">        and display its string representation instead of the raw id.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : auditlog.models.LogEntry</span>
<span class="sd">            The audit log entry instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A human readable description of the changes or ``&quot;-&quot;`` when no</span>
<span class="sd">            meaningful data is present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">changes</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;-&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">changes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">changes</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">changes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">changes</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">changes</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">changes</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">content_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span>

        <span class="n">model_class</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">model_class</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_class</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span>

        <span class="n">formatted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">changes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">old_val</span><span class="p">,</span> <span class="n">new_val</span> <span class="o">=</span> <span class="n">values</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">model_class</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;related_model&#39;</span><span class="p">):</span>
                    <span class="n">fk_model</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">related_model</span>

                    <span class="n">old_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">old_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">old_val</span><span class="p">)</span>
                    <span class="n">new_id</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">new_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>

                    <span class="n">old_obj</span> <span class="o">=</span> <span class="n">fk_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">old_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="k">if</span> <span class="n">old_id</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">new_obj</span> <span class="o">=</span> <span class="n">fk_model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">new_id</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span> <span class="k">if</span> <span class="n">new_id</span> <span class="k">else</span> <span class="kc">None</span>

                    <span class="n">old_display</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">old_obj</span><span class="p">)</span> <span class="k">if</span> <span class="n">old_obj</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>
                    <span class="n">new_display</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_obj</span><span class="p">)</span> <span class="k">if</span> <span class="n">new_obj</span> <span class="k">else</span> <span class="s2">&quot;None&quot;</span>

                    <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">old_display</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">new_display</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">old_val</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">new_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">old_val</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">new_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span> <span class="k">if</span> <span class="n">formatted</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span></div>


    <span class="n">changes_formatted</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s2">&quot;Changes&quot;</span>

<div class="viewcode-block" id="LogEntryAdmin.formatted_timestamp">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.LogEntryAdmin.formatted_timestamp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">formatted_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a human-friendly timestamp for display in list views.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : auditlog.models.LogEntry</span>
<span class="sd">            The audit log entry instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Formatted timestamp as ``YYYY-MM-DD HH:MM:SS``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span></div>

    <span class="n">formatted_timestamp</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s2">&quot;timestamp&quot;</span>
    <span class="n">formatted_timestamp</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s2">&quot;Timestamp&quot;</span></div>


<span class="c1">############################</span>
<span class="c1">#     Statistic Class      #</span>
<span class="c1">############################</span>
<div class="viewcode-block" id="StatisticAdmin">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin">[docs]</a>
<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Statistic</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StatisticAdmin</span><span class="p">(</span><span class="n">AdminCount</span><span class="p">,</span> <span class="n">AdminWriteCSV</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin used to display aggregated site statistics.&quot;&quot;&quot;</span>

    <span class="n">change_list_template</span> <span class="o">=</span> <span class="s2">&quot;admin/admin_statistics_changelist.html&quot;</span> <span class="c1">#: Template used to render the statistics changelist.</span>

<div class="viewcode-block" id="StatisticAdmin.get_books_per_genre">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.get_books_per_genre">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_books_per_genre</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return counts of books grouped by genre name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.db.models.query.QuerySet</span>
<span class="sd">            QuerySet of dicts with keys ``genre__name`` and ``count``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_count</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="s2">&quot;genre__name&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="StatisticAdmin.get_authors_per_nationality">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.get_authors_per_nationality">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_authors_per_nationality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return counts of authors grouped by nationality name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.db.models.query.QuerySet</span>
<span class="sd">            QuerySet of dicts with keys ``nationality__name`` and ``count``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate_count</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="s2">&quot;nationality__name&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="StatisticAdmin.get_author_stats">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.get_author_stats">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_author_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute per-author statistics for solo and co-authored books.</span>

<span class="sd">        The function annotates authors with counts of books where they are the</span>
<span class="sd">        sole author and counts where the book has more than one author.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of dictionaries in the form ``{&quot;author&quot;: str, &quot;solo_books&quot;: int, &quot;coauthored_books&quot;: int}``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">books_with_author_count</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_authors</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;authors&#39;</span><span class="p">))</span>

        <span class="n">authors_stats_qs</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="n">solo_books</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span>
                <span class="n">Case</span><span class="p">(</span>
                    <span class="n">When</span><span class="p">(</span><span class="n">books__in</span><span class="o">=</span><span class="n">books_with_author_count</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">num_authors</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">then</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">output_field</span><span class="o">=</span><span class="n">IntegerField</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="n">coauthored_books</span><span class="o">=</span><span class="n">Sum</span><span class="p">(</span>
                <span class="n">Case</span><span class="p">(</span>
                    <span class="n">When</span><span class="p">(</span><span class="n">books__in</span><span class="o">=</span><span class="n">books_with_author_count</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">num_authors__gt</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">then</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                    <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">output_field</span><span class="o">=</span><span class="n">IntegerField</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">author_stats</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">author</span><span class="p">),</span>
                <span class="s2">&quot;solo_books&quot;</span><span class="p">:</span> <span class="n">author</span><span class="o">.</span><span class="n">solo_books</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;coauthored_books&quot;</span><span class="p">:</span> <span class="n">author</span><span class="o">.</span><span class="n">coauthored_books</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">authors_stats_qs</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">author_stats</span></div>


<div class="viewcode-block" id="StatisticAdmin.changelist_view">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.StatisticAdmin.changelist_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">changelist_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render the custom statistics changelist view.</span>

<span class="sd">        This view prepares multiple statistic sections (books per genre,</span>
<span class="sd">        authors per nationality and per-author stats) and injects them into</span>
<span class="sd">        the changelist template. Supports CSV export via ``?export=csv``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        extra_context : dict</span>
<span class="sd">            Additional context to pass to the changelist template.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse</span>
<span class="sd">            The response for the changelist (or CSV file when requested).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">extra_context</span> <span class="o">=</span> <span class="n">extra_context</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="n">books_per_genre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_books_per_genre</span><span class="p">()</span>
        <span class="n">authors_per_nationality</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authors_per_nationality</span><span class="p">()</span>
        <span class="n">author_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_author_stats</span><span class="p">()</span>

        <span class="n">sections</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Books per Genre&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Genre&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">],</span> <span class="n">books_per_genre</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;genre__name&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])),</span>
            <span class="p">(</span><span class="s2">&quot;Authors per Nationality&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Nationality&quot;</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">],</span> <span class="n">authors_per_nationality</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;nationality__name&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">])),</span>
            <span class="p">(</span><span class="s2">&quot;Author Statistics&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Author&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo Books&quot;</span><span class="p">,</span> <span class="s2">&quot;Co-authored Books&quot;</span><span class="p">],</span> <span class="n">author_stats</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;solo_books&quot;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;coauthored_books&quot;</span><span class="p">])),</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;export&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_csv</span><span class="p">(</span><span class="n">sections</span><span class="p">)</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;books_per_genre&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_books_per_genre</span><span class="p">(),</span>
            <span class="s2">&quot;authors_per_nationality&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_authors_per_nationality</span><span class="p">(),</span>
            <span class="s2">&quot;author_stats&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_author_stats</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">extra_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">changelist_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">extra_context</span><span class="o">=</span><span class="n">extra_context</span><span class="p">)</span></div>
</div>


<span class="c1">############################</span>
<span class="c1">#      Author Classes      #</span>
<span class="c1">############################</span>
<div class="viewcode-block" id="AuthorBookInLine">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorBookInLine</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">TabularInline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inline showing basic book info for an Author&#39;s books.&quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BookAuthor</span> <span class="c1">#: The through model (``BookAuthor``) used by this inline.</span>
    <span class="n">can_delete</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#: Whether items can be deleted from the inline.</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#: Number of extra blank rows shown on the add view.</span>
    <span class="n">max_num</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#: Maximum number of inline forms to display.</span>
    <span class="n">show_change_link</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#: Whether a change link is shown for each inline row.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;title&#39;</span><span class="p">,</span>
        <span class="s1">&#39;authors&#39;</span><span class="p">,</span>
        <span class="s1">&#39;genre&#39;</span><span class="p">,</span>
        <span class="s1">&#39;isbn&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cover&#39;</span><span class="p">,</span>
        <span class="s1">&#39;adapted&#39;</span><span class="p">,</span>
        <span class="s1">&#39;film_title&#39;</span>
    <span class="p">)</span> <span class="c1">#: The fields shown in the inline.</span>
    <span class="n">readonly_fields</span> <span class="o">=</span> <span class="n">fields</span> <span class="c1">#: Fields that are displayed read-only in the inline.</span>

<div class="viewcode-block" id="AuthorBookInLine.title">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.title">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the title of the related book for display in the inline.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The related Book title.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">title</span></div>


<div class="viewcode-block" id="AuthorBookInLine.authors">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.authors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">authors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a comma-separated list of authors for the related book.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Comma-separated author names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">ordered_authors</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">authors</span><span class="p">)</span></div>


<div class="viewcode-block" id="AuthorBookInLine.genre">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.genre">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">genre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the genre name of the related book.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The related Book&#39;s genre name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">genre</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="AuthorBookInLine.isbn">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.isbn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">isbn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the ISBN of the related book.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The ISBN string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">isbn</span></div>


<div class="viewcode-block" id="AuthorBookInLine.cover">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.cover">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an HTML thumbnail linking to the book cover or a placeholder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            HTML-safe snippet with an &lt;img&gt; tag or &quot;-&quot; when no cover exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">cover</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">cover</span><span class="o">.</span><span class="n">url</span>
            <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span>
                <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">{}</span><span class="s1">&quot; target=&quot;_blank&quot;&gt;&#39;</span>
                <span class="s1">&#39;&lt;img src=&quot;</span><span class="si">{}</span><span class="s1">&quot; style=&quot;max-height:50px;&quot; /&gt;&#39;</span>
                <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">,</span>
                <span class="n">url</span><span class="p">,</span> <span class="n">url</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;-&quot;</span></div>


<div class="viewcode-block" id="AuthorBookInLine.adapted">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.adapted">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">adapted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the related book is an adaptation (film/etc.).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True when the book is marked as adapted, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">adapted</span></div>


<div class="viewcode-block" id="AuthorBookInLine.film_title">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorBookInLine.film_title">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">film_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the film title for adapted works or &#39;-&#39; when not present.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : bookprocess.models.BookAuthor</span>
<span class="sd">            The inline relation instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The film title or ``&quot;-&quot;`` when not available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">book</span><span class="o">.</span><span class="n">film_title</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span></div>
</div>


<div class="viewcode-block" id="AuthorPopulateForm">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorPopulateForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorPopulateForm</span><span class="p">(</span><span class="n">AdminPopulateForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Populate form specialized for author imports (Excel files).&quot;&quot;&quot;</span>
    <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.xlsx&quot;</span><span class="p">]</span> <span class="c1">#: Allowed file extensions for the form.</span></div>


<div class="viewcode-block" id="AuthorAdmin">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin">[docs]</a>
<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AuthorAdmin</span><span class="p">(</span><span class="n">AdminPagination</span><span class="p">,</span> <span class="n">AdminPopulate</span><span class="p">,</span> <span class="n">AdminSave</span><span class="p">,</span> <span class="n">AdminDelete</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin for the :class:`bookprocess.models.Author` model.&quot;&quot;&quot;</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">AuthorBookInLine</span><span class="p">]</span> <span class="c1">#: Inline admin classes shown on the author change view (e.g. book list).</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;nationality&#39;</span><span class="p">)</span> <span class="c1">#: Columns shown in the changelist.</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">)</span> <span class="c1">#: Fields used for search in the changelist.</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;nationality&#39;</span><span class="p">,</span> <span class="n">RelatedDropdownFilter</span><span class="p">),</span>
    <span class="p">)</span> <span class="c1">#: Tuple of list filters applied in the changelist.</span>
    <span class="n">populate_form_class</span> <span class="o">=</span> <span class="n">AuthorPopulateForm</span> <span class="c1">#: Form class used to upload author import files.</span>
    <span class="n">populate_command_class</span> <span class="o">=</span> <span class="n">AuthorsCmd</span> <span class="c1">#:  Management command used to import author data.</span>

<div class="viewcode-block" id="AuthorAdmin.get_readonly_fields">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.get_readonly_fields">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_readonly_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return read-only fields for the Author admin.</span>

<span class="sd">        If the author is the primary author on any book, prevent changing</span>
<span class="sd">        the ``nationality`` via the admin to preserve data consistency.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        obj : Author</span>
<span class="sd">            The instance being viewed/edited (None on add form).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            A list of field names that should be read-only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">readonly</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_readonly_fields</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">books</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">bookauthor__order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">readonly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nationality&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">readonly</span></div>


<div class="viewcode-block" id="AuthorAdmin.name">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.AuthorAdmin.name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a human-friendly name for the author instance.</span>

<span class="sd">        This method is used in the admin list display. It proxies to the</span>
<span class="sd">        model&#39;s ``name()`` helper.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Author</span>
<span class="sd">            The author instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The formatted author name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">()</span></div>

    <span class="n">name</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s1">&#39;first_name&#39;</span></div>


<span class="c1">############################</span>
<span class="c1">#        Book Classes      #</span>
<span class="c1">############################</span>
<div class="viewcode-block" id="BookForm">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BookForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Form used in the Book admin providing validation and media assets.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="BookForm.Meta">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Meta">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Meta configuration linking the form to the Book model and including all fields.&quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span> <span class="c1">#: Model used for this form.</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;__all__&quot;</span> <span class="c1">#: Fields from model.</span></div>


<div class="viewcode-block" id="BookForm.clean">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.clean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate interdependent fields for Book.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The cleaned form data dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cleaned_data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="n">adapted</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;adapted&quot;</span><span class="p">)</span>
        <span class="n">film_title</span> <span class="o">=</span> <span class="n">cleaned_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;film_title&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">adapted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">film_title</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_error</span><span class="p">(</span><span class="s2">&quot;film_title&quot;</span><span class="p">,</span> <span class="s2">&quot;Please enter a film title for adapted books.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">adapted</span><span class="p">:</span>
            <span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;film_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">cleaned_data</span></div>


<div class="viewcode-block" id="BookForm.Media">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookForm.Media">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Media</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Include custom JavaScript for dynamic field behavior within the admin form.&quot;&quot;&quot;</span>
        <span class="n">js</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;admin/js/admin_book_form_adapted_film_isbn_cover.js&quot;</span><span class="p">,</span><span class="s2">&quot;admin/js/admin_book_form_authors.js&quot;</span><span class="p">)</span> <span class="c1">#: JavaScript files included for dynamic behavior in the admin form.</span></div>
</div>


<div class="viewcode-block" id="BookAddMultipleForm">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAddMultipleForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BookAddMultipleForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Form for adding multiple books for the same author dynamically.&quot;&quot;&quot;</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span>
        <span class="n">queryset</span><span class="o">=</span><span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Select Author&quot;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;vForeignKeyRawIdAdminField&#39;</span><span class="p">})</span>
    <span class="p">)</span> <span class="c1">#: The ModelChoiceField selecting the author to attach to created books.</span></div>


<div class="viewcode-block" id="BookAuthorInline">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BookAuthorInline</span><span class="p">(</span><span class="n">SortableInlineAdminMixin</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">TabularInline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inline admin for the BookAuthor through-model.</span>

<span class="sd">    Presents a sortable inline to associate authors with a Book and</span>
<span class="sd">    controls the number of empty extra forms shown on add vs edit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BookAuthor</span> <span class="c1">#: The through model (``BookAuthor``) used by this inline.</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#: Number of extra blank forms to display on the add view.</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,)</span> <span class="c1">#: Fields shown in the inline form.</span>
    <span class="n">autocomplete_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,)</span> <span class="c1">#: Fields that use autocomplete widgets.</span>
    <span class="n">sortable_field_name</span> <span class="o">=</span> <span class="s1">&#39;order&#39;</span> <span class="c1">#: Name of the field used by adminsortable2 for ordering.</span>

<div class="viewcode-block" id="BookAuthorInline.get_extra">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAuthorInline.get_extra">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_extra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of extra inline forms to display.</span>

<span class="sd">        When editing an existing Book instance we don&#39;t show extra empty</span>
<span class="sd">        inline rows; when adding a new book we provide one extra row to</span>
<span class="sd">        easily add a first author.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        obj : None</span>
<span class="sd">            The parent object being edited. None on the add form.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            A dictionary of optional keyword arguments passed by Django.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of extra inline forms to display.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">1</span></div>
</div>


<div class="viewcode-block" id="BookPopulateForm">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookPopulateForm">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BookPopulateForm</span><span class="p">(</span><span class="n">AdminPopulateForm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Populate form for importing books; expects a ZIP containing an Excel file.&quot;&quot;&quot;</span>
    <span class="n">allowed_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;.zip&quot;</span><span class="p">]</span> <span class="c1">#: Allowed file extensions</span></div>


<div class="viewcode-block" id="BookAdmin">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin">[docs]</a>
<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BookAdmin</span><span class="p">(</span><span class="n">SortableAdminBase</span><span class="p">,</span> <span class="n">AdminPagination</span><span class="p">,</span> <span class="n">AdminPopulate</span><span class="p">,</span> <span class="n">AdminDelete</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Admin for the :class:`bookprocess.models.Book` model providing helpers for authors, covers and bulk add.&quot;&quot;&quot;</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">BookForm</span> <span class="c1">#: Custom form class used for add/change views (``BookForm``).</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">BookAuthorInline</span><span class="p">]</span> <span class="c1">#: Inline classes (``BookAuthorInline``) to manage authors.</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;display_authors&#39;</span><span class="p">,</span> <span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="s1">&#39;adapted&#39;</span><span class="p">,</span> <span class="s1">&#39;film_title&#39;</span><span class="p">)</span> <span class="c1">#: Columns shown in the changelist.</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="s1">&#39;bookauthor__author__first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;bookauthor__author__last_name&#39;</span><span class="p">)</span> <span class="c1">#: Fields used in changelist search.</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="n">RelatedDropdownFilter</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;adapted&#39;</span><span class="p">,</span> <span class="n">DropdownFilter</span><span class="p">),</span>
    <span class="p">)</span> <span class="c1">#: Filters displayed in the changelist.</span>
    <span class="n">readonly_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;isbn&#39;</span><span class="p">,</span> <span class="s1">&#39;cover_preview&#39;</span><span class="p">)</span> <span class="c1">#:  Read-only fields in the change view.</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;fields&#39;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;genre&#39;</span><span class="p">,</span> <span class="s1">&#39;cover&#39;</span><span class="p">,</span> <span class="s1">&#39;cover_preview&#39;</span><span class="p">,</span>
                <span class="s1">&#39;adapted&#39;</span><span class="p">,</span> <span class="s1">&#39;film_title&#39;</span><span class="p">,</span> <span class="s1">&#39;isbn&#39;</span>
            <span class="p">)</span>
        <span class="p">}),</span>
    <span class="p">)</span> <span class="c1">#: Fieldset configuration used in the change form.</span>

    <span class="n">multiple_url</span> <span class="o">=</span> <span class="s2">&quot;multiple/&quot;</span> <span class="c1">#: Route suffix for the add-multiple view.</span>
    <span class="n">multiple_button</span> <span class="o">=</span> <span class="s2">&quot;Add multiple books for the same author&quot;</span> <span class="c1">#: Label for the multiple-add action button.</span>
    <span class="n">populate_form_class</span> <span class="o">=</span> <span class="n">BookPopulateForm</span> <span class="c1">#: Populate form class used for importing books.</span>
    <span class="n">populate_command_class</span> <span class="o">=</span> <span class="n">BookCmd</span> <span class="c1">#: Management command used for population imports.</span>
    <span class="n">is_zip_file</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#: When True the populate view expects a ZIP containing an Excel file.</span>

<div class="viewcode-block" id="BookAdmin.display_authors">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.display_authors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">display_authors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a comma-separated list of the book&#39;s authors for display.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Book</span>
<span class="sd">            The Book instance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            Comma-separated author names or an em-dash when none are present.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="n">ba</span><span class="o">.</span><span class="n">author</span> <span class="k">for</span> <span class="n">ba</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">bookauthor_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">authors</span><span class="p">)</span> <span class="k">if</span> <span class="n">authors</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span></div>

    <span class="n">display_authors</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s2">&quot;Authors&quot;</span>

<div class="viewcode-block" id="BookAdmin.cover_preview">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.cover_preview">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">cover_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return HTML for a clickable cover preview image.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Book</span>
<span class="sd">            The Book instance. May be ``None`` in some admin contexts.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            An HTML snippet with an &lt;img&gt; wrapped in a link or an empty</span>
<span class="sd">            string when no cover is available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;cover&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span>
            <span class="s1">&#39;&lt;a href=&quot;</span><span class="si">{}</span><span class="s1">&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;</span><span class="si">{}</span><span class="s1">&quot; style=&quot;height:150px;&quot; /&gt;&lt;/a&gt;&#39;</span><span class="p">,</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cover</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">cover</span><span class="o">.</span><span class="n">url</span>
        <span class="p">)</span></div>

    <span class="n">cover_preview</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s2">&quot;Cover Preview&quot;</span>

<div class="viewcode-block" id="BookAdmin.save_model">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.save_model">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a new Book instance with proper audit handling.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        obj : Book</span>
<span class="sd">            The Book instance to save.</span>
<span class="sd">        form : django.forms.Form</span>
<span class="sd">            The admin form used to validate the instance.</span>
<span class="sd">        change : bool</span>
<span class="sd">            True if updating an existing object, False for creation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">change</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">disable_auditlog</span><span class="p">():</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">before_obj</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
                    <span class="n">before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snapshot_book_state</span><span class="p">(</span><span class="n">before_obj</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                    <span class="n">before</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">before</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">request</span><span class="o">.</span><span class="n">_bookadmin_before</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;_bookadmin_before&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">if</span> <span class="n">before</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">:</span>
                <span class="n">request</span><span class="o">.</span><span class="n">_bookadmin_before</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">]</span> <span class="o">=</span> <span class="n">before</span>

            <span class="k">with</span> <span class="n">disable_auditlog</span><span class="p">():</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span></div>


<div class="viewcode-block" id="BookAdmin.save_formset">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.save_formset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_formset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">formset</span><span class="p">,</span> <span class="n">change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save related formset data and perform post-save bookkeeping.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        form : django.forms.Form</span>
<span class="sd">            The parent Book admin form.</span>
<span class="sd">        formset : django.forms.BaseInlineFormSet</span>
<span class="sd">            The inline formset containing BookAuthor relations.</span>
<span class="sd">        change : bool</span>
<span class="sd">            True when updating an existing book, False for create.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            This method performs in-place saves and does not return a value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_authors_from_formset</span><span class="p">(</span><span class="n">formset</span><span class="p">)</span>

        <span class="n">book</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">instance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">change</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_book_creation</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_book_isbn_if_needed</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">)</span>

            <span class="n">before</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;_bookadmin_before&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">after_obj</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">book</span><span class="p">)</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">prefetch_related</span><span class="p">(</span>
                    <span class="s1">&#39;bookauthor_set__author&#39;</span><span class="p">,</span> <span class="s1">&#39;genre&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">book</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">type</span><span class="p">(</span><span class="n">book</span><span class="p">)</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="n">after_obj</span> <span class="o">=</span> <span class="n">book</span>
            <span class="n">after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snapshot_book_state</span><span class="p">(</span><span class="n">after_obj</span><span class="p">)</span>
            <span class="n">changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_diff_snapshots</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">)</span> <span class="k">if</span> <span class="n">before</span> <span class="k">else</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
                <span class="n">AuditLogService</span><span class="o">.</span><span class="n">log_book_update</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span></div>


<div class="viewcode-block" id="BookAdmin._save_authors_from_formset">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._save_authors_from_formset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_save_authors_from_formset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formset</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marks objects as ``_from_admin`` prior to saving so</span>
<span class="sd">        downstream hooks can differentiate admin-created relations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        formset : django.forms.BaseInlineFormSet</span>
<span class="sd">            The inline formset of BookAuthor instances.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="n">formset</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_from_admin</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">formset</span><span class="o">.</span><span class="n">deleted_objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_from_admin</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="n">formset</span><span class="o">.</span><span class="n">save_m2m</span><span class="p">()</span></div>


<div class="viewcode-block" id="BookAdmin._finalize_book_creation">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._finalize_book_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_finalize_book_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an ISBN for a newly created Book and emit a CREATE log.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        user : django.contrib.auth.models.User</span>
<span class="sd">            The user performing the creation.</span>
<span class="sd">        book : Book</span>
<span class="sd">            The Book instance that was created.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">first_author</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">bookauthor_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">first_author</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">disable_auditlog</span><span class="p">():</span>
                <span class="n">book</span><span class="o">.</span><span class="n">isbn</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">generate_isbn</span><span class="p">()</span>
                <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isbn&#39;</span><span class="p">])</span>
        <span class="n">AuditLogService</span><span class="o">.</span><span class="n">log_book_creation</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">)</span></div>



<div class="viewcode-block" id="BookAdmin._update_book_isbn_if_needed">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._update_book_isbn_if_needed">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_update_book_isbn_if_needed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Regenerate the ISBN only when the primary author&#39;s nationality changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        user : django.contrib.auth.models.User</span>
<span class="sd">            Acting user (audit actor).</span>
<span class="sd">        book : Book</span>
<span class="sd">            Instance to possibly update.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">first_author_rel</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">book</span><span class="o">.</span><span class="n">bookauthor_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">select_related</span><span class="p">(</span><span class="s1">&#39;author__nationality&#39;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_author_rel</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">author</span> <span class="o">=</span> <span class="n">first_author_rel</span><span class="o">.</span><span class="n">author</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">author</span><span class="p">,</span> <span class="s2">&quot;nationality&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">_normalize_nat_code</span>
        <span class="n">nat_code_current</span> <span class="o">=</span> <span class="n">_normalize_nat_code</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">nat</span><span class="p">,</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span> <span class="k">if</span> <span class="n">nat</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">book</span><span class="o">.</span><span class="n">isbn</span><span class="p">:</span>
            <span class="n">new_isbn</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">generate_isbn</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_isbn</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">disable_auditlog</span><span class="p">():</span>
                    <span class="n">book</span><span class="o">.</span><span class="n">isbn</span> <span class="o">=</span> <span class="n">new_isbn</span>
                    <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isbn&#39;</span><span class="p">])</span>
            <span class="k">return</span>

        <span class="n">old_nat_code</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">isbn</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">isbn</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">nat_code_current</span> <span class="ow">or</span> <span class="n">nat_code_current</span> <span class="o">==</span> <span class="n">old_nat_code</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">new_isbn</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">generate_isbn</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">new_isbn</span> <span class="ow">and</span> <span class="n">new_isbn</span> <span class="o">!=</span> <span class="n">book</span><span class="o">.</span><span class="n">isbn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">disable_auditlog</span><span class="p">():</span>
                <span class="n">book</span><span class="o">.</span><span class="n">isbn</span> <span class="o">=</span> <span class="n">new_isbn</span>
                <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;isbn&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="BookAdmin._snapshot_book_state">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._snapshot_book_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_snapshot_book_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">book</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a snapshot dict of fields used in manual update audit logs.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Keys: id, title, genre, cover, adapted, film_title, isbn, authors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="p">[</span><span class="n">ba</span><span class="o">.</span><span class="n">author</span> <span class="k">for</span> <span class="n">ba</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">bookauthor_set</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">)]</span>
        <span class="n">authors_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">authors</span><span class="p">)</span> <span class="k">if</span> <span class="n">authors</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">genre</span><span class="p">)</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="s2">&quot;genre&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;cover&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">cover</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;adapted&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">adapted</span><span class="p">),</span>
            <span class="s2">&quot;film_title&quot;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">film_title</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;isbn&quot;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">isbn</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;authors&quot;</span><span class="p">:</span> <span class="n">authors_str</span><span class="p">,</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="BookAdmin._diff_snapshots">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._diff_snapshots">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_diff_snapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute a changes dict for audit logging.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        before : dict</span>
<span class="sd">            Pre-change snapshot.</span>
<span class="sd">        after : dict</span>
<span class="sd">            Post-change snapshot.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Mapping field_name -&gt; [old_value, new_value]. Empty when there is</span>
<span class="sd">            no actual change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">before</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Detect if any field actually changed</span>
        <span class="n">any_changed</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">before</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">!=</span> <span class="n">after</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">after</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">any_changed</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Include all fields in the log for context</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">before</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">after</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">after</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span></div>


<div class="viewcode-block" id="BookAdmin.get_urls">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.get_urls">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return admin URL patterns including the multiple-create view.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of URL patterns for this admin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">path</span><span class="p">(</span><span class="s2">&quot;multiple/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_site</span><span class="o">.</span><span class="n">admin_view</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_multiple_books_view</span><span class="p">)),</span>
        <span class="p">]</span> <span class="o">+</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_urls</span><span class="p">()</span></div>


<div class="viewcode-block" id="BookAdmin.add_multiple_books_view">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin.add_multiple_books_view">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_multiple_books_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the add-multiple-books admin view.</span>

<span class="sd">        Supports GET to render the form and POST to process submitted</span>
<span class="sd">        multiple-book data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The incoming request.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse</span>
<span class="sd">            The rendered form or a redirect after processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_multiple_books_post</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_multiple_books_form</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></div>


<div class="viewcode-block" id="BookAdmin._handle_multiple_books_post">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._handle_multiple_books_post">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_multiple_books_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the form, creates Book instances and associated</span>
<span class="sd">        BookAuthor relations and shows a summary message.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The POST request containing form data.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponseRedirect or django.http.HttpResponse</span>
<span class="sd">            Redirect back to the changelist on success or the form</span>
<span class="sd">            rendered with errors on invalid input.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">BookAddMultipleForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_multiple_books_form</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="p">)</span>

        <span class="n">author</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">]</span>
        <span class="n">books_created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_books_from_post_data</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show_creation_message</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">books_created</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s2">&quot;../&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BookAdmin._create_books_from_post_data">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._create_books_from_post_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_books_from_post_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loop through POSTed book entries and create Book objects.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The request containing POST data and FILES.</span>
<span class="sd">        author : Author</span>
<span class="sd">            The author to attach as the primary author to each created book.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Number of successfully created books.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">books_created</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_title&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">:</span>
            <span class="n">created</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_single_book_from_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
                <span class="n">books_created</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">books_created</span></div>


<div class="viewcode-block" id="BookAdmin._create_single_book_from_post">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._create_single_book_from_post">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_create_single_book_from_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a single Book from indexed POST fields.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The request with POST data and FILES.</span>
<span class="sd">        index : int</span>
<span class="sd">            The index used to locate the set of fields for this book.</span>
<span class="sd">        author : Author</span>
<span class="sd">            The primary author to associate with the created Book.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True when the book was created, False when required fields</span>
<span class="sd">            were missing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">book_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_book_data_from_post</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">disable_auditlog</span><span class="p">():</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">book_data</span><span class="p">)</span>
            <span class="n">BookAuthor</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">book</span><span class="o">=</span><span class="n">book</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">new_isbn</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">generate_isbn</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">new_isbn</span><span class="p">:</span>
                <span class="n">book</span><span class="o">.</span><span class="n">isbn</span> <span class="o">=</span> <span class="n">new_isbn</span>
                <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;isbn&quot;</span><span class="p">])</span>

        <span class="n">AuditLogService</span><span class="o">.</span><span class="n">log_book_creation</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">book</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="BookAdmin._extract_book_data_from_post">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._extract_book_data_from_post">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_book_data_from_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract a book&#39;s fields from POST using the given index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The request containing POST and FILES.</span>
<span class="sd">        index : int</span>
<span class="sd">            The index used to construct field names.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Keyword args suitable for ``Book.objects.create(**kwargs)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genre_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_genre&quot;</span><span class="p">)</span>
        <span class="n">adapted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_adapted&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;on&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">genre</span> <span class="o">=</span> <span class="n">Genre</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">genre_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">genre_id</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="n">Genre</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="n">genre</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s2">&quot;genre&quot;</span><span class="p">:</span> <span class="n">genre</span><span class="p">,</span>
            <span class="s2">&quot;adapted&quot;</span><span class="p">:</span> <span class="n">adapted</span><span class="p">,</span>
            <span class="s2">&quot;film_title&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_film_title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="n">adapted</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;cover&quot;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;book_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">_cover&quot;</span><span class="p">)</span>
        <span class="p">}</span></div>


<div class="viewcode-block" id="BookAdmin._show_creation_message">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._show_creation_message">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_show_creation_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">books_created</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a success or warning message after attempting creation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request for context (used by ``messages``).</span>
<span class="sd">        books_created : int</span>
<span class="sd">            Number of books successfully created.</span>
<span class="sd">        author : Author</span>
<span class="sd">            The author for whom books were created.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">books_created</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Successfully added </span><span class="si">{</span><span class="n">books_created</span><span class="si">}</span><span class="s2"> book(s) for </span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;No books were added.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BookAdmin._render_multiple_books_form">
<a class="viewcode-back" href="../../bookprocess.admin.html#bookprocess.admin.BookAdmin._render_multiple_books_form">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_render_multiple_books_form</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render the add-multiple-books form template.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request : django.http.HttpRequest</span>
<span class="sd">            The current request.</span>
<span class="sd">        form : BookAddMultipleForm</span>
<span class="sd">            Optional form instance (used to re-render validation errors).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        django.http.HttpResponse</span>
<span class="sd">            Rendered HTML response of the form.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">form</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="n">BookAddMultipleForm</span><span class="p">()</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">admin_site</span><span class="o">.</span><span class="n">each_context</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
            <span class="s2">&quot;genres&quot;</span><span class="p">:</span> <span class="n">Genre</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Add Multiple Books for Same Author&quot;</span><span class="p">,</span>
            <span class="s2">&quot;opts&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_meta</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;admin/admin_add_multiple_books_form.html&quot;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Mihalcea Marius-Alex.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>